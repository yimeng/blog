---
title: "基础设施即代码-cloud-init"
date: 2021-09-04T09:19:00+08:00
---

# 基础设施即代码-cloud-init

第一次接触这个东西应该是在2012年，在创建aws的ec2上的时候，需要注入主机名。当时aws给了一个输入框，可以往里写一些“变量”。在启动的时候就可以按照规定好的变量进行设置。而且还能通过一个URL访问这些变量。这可能就是一开始的cloud-init

## 使用阶段

这个东西应该是在通过pxe打包好了镜像之后（也安装了cloud-init）使用的。但有个悖论就是：cloud-init里面有一些软件包的安装过程，这个跟pxe里面的软件包安装甚至cloud-init后续的ansible/puppet过程的软件包安装可能会有冲突。所以软件包安装这个行为需要谨慎的进行考虑其各个阶段的作用。那么cloud-init在其生命周期里，主要可以用来做什么呢？个人感觉如下几个功能可以供参考：

- 主机名的初始化
- 用户初始化
- 公钥的注入
- 一些通过PXE镜像基线没有搞定的事情弥补下
- 分区挂载（如果有运维标准的话可以做）

这个阶段已经开始有IP地址了，准备让应用运维上来初始化他们自己的机器了，基础软件在PXE还有一些小问题的，需要通过这个阶段弥补下。

不适合做的事情：

- 应用软件的安装（交给应用运维用puppet或者ansible）
- 
