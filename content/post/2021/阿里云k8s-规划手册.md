# 阿里云k8s 规划手册

## K8S限制

在 v1.19 版本中， Kubernetes 支持的最大节点数为 5000。更具体地说，我们支持满足以下所有条件的配置：

- 节点数不超过 5000 
- Pod 总数不超过 150000 
- 容器总数不超过 300000
- 每个节点的 pod 数量不超过 100

## 选型步骤

- 阿里云K8S分类
- 网络规划 
- ECS选型 
- 网络选型 
- 配置设置

## 阿里云k8s分类

![image-20201124121734196](/Users/yimeng/Library/Application Support/typora-user-images/image-20201124121734196.png)

1. 生产环境 Dedicated K8S 自主可控

2. 测试环境：Managed K8S 节省成本

3. 持续集成 、Job任务：K8S Serverless

   ## 

## 网络规划

### VPC

1. K8S使用独立的VPC，不建议混用。如混用需要重新规划
2. 单个VPC支持云资源使用的私网网络地址数量 60,000  VPC建议使用 16掩码：/16 65532 
3. 建议k8s独立的VPC，通过云企业网等打通。
4. 单个地域支持创建的VPC的数量 10个 北京9个可用区 共计 90个VPC

### 交换机

1. 交换机网段建议使用20(4094)-21(2046)掩码（为了最大利用IP地址，虚拟机一般用24掩码即可）
2. 单个VPC支持创建的交换机的数量 24个(阿里云限制)
3. 每个交换机平均掩码长度/20-/21 可用IP数 2044-4092 * 24 ~ 49056 < 65532 < 98208 
4. service 数量 1.5:5  svc:pod   1.5w 预留

## ECS选型

### 神龙

Node 配置104C 384G 12000/月  每个POD：2C4G  每个Node ~100<110 POD  

### ECS

2C4G EC2 197/月*100台ECS虚拟机 19700/月

节省25%~40%

北京**A**，**B**，**C**，**D**，**E**，杭州**BCDE**，上海**D**可用区不可以再扩容，售卖规格对新用户停售。

## 网络选型

flannel：如果有一些二次开发的系统以来，可以继续使用。

terway：阿里云推荐，可以进行网络隔离和独立网卡使用。POD和Node可以处于同一网络平面



## 配置设置

区域：北京

VPC 10.0.0.0/16 (65532 IP)

Switch（4092 IP）: 北京F 10.1.0.0/20  北京 G 10.1.16.0/20 北京H 10.1.32.0/20

网络类型：terway

Service CIDR(16382)：10.0.0.0/18 (每个集群只能创建一次)

配置SNAT ：是

公网访问：生产不建议打开 测试可以打开

kube-proxy：IPVS

实例规格：生产建议使用神龙服务器，测试可以选择ECS

存储插件：CSI

